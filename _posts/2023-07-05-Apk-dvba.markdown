---
title:  "Pentest a aplicaciones Android dvba.apk"
date:   2023-07-05
categories: [Walkthrough]
tags: [Android,APK,mobile]
---

Antes que nada, quisiera dedicarle este walkthrough a una de las personas mas importantes en mi carrera profesional, siempre quise trabajar a su lado y fue un honor.
¡Gracias totales!. 

1. Reverse the android application.

Decompilación del apk. 

``` bash
#Decompilacion de la aplicacion con apktool.jar
java -jar apktool_2.7.0.jar d -f -o aplicacion/smaliapk/
#decompilacion con apktool
apktool d dvba.apk -o dvba.apktool
```
Una vez descomprimida la aplicación se debe identificar el motivo por el cual no es posible ejecutarla dentro de emuladores, en este caso Genymotion. 

Se identifica que uno de los posibles motivos se puede encontrar en el AndroidManifest.xml 

En la linea que contenga la información de `hardwareAccelerated="true"`. 

¿Porque esa línea? La verdad no me acuerdo, se que tiene algo que ver con la gpu de dispositivos móviles y como genymotion o los emuladores no tienen gpu, se identifica de esa manera que la aplicación esta corriendo en un emulador. 

![image](/genes/dvba/hardwareAccelerated.png)

Se supone que para lograr este primer bypass, basta con cambiar el valor de True a False, volver a empaquetar la aplicación e intenter ejecutarla. 

El dilema es que la herramienta o el comando de apktool no me sirve, me genera varios errores y no compila la aplcación, peeero con `apktool_2.7.0.jar` si se puede pa.  

07/07 tercer día de intento, descomprimí y comprimí la aplicación unas 6 veces en estos días, debido a que no lograba ejecutar el aplicativo, me acabo de dar cuenta, de que esta bien el error y posiblemente en el siguiente paso se solucionará, ¡ Detalles !. 

Se busca la siguiente linea ya que es el mensaje de erro obtenido por la aplicación `Emulator Detected`. 

![image](/genes/dvba/emulatordetected.png)

Según mis opciones abro el archivo MainActivity.smali, pero debería ser .jar, al parecer es por la no implementación de la herramienta `apkx` herramienta, que se descarga, pero no ejecuta...... MALDITHA ZEA. 

Al parecer lo solucione editando el archivo apkx alojado en la ruta /usr/local/bin, utiliza pyhton y no tenia python, pero si python3, solo era ajustar la ubicación. Primero con which python, despúes remplazar y funciona. 

![image](/genes/dvba/apkx.png)

Se utiliza la herramienta de apkx que sirve para: "Extrae el código fuente de Java directamente desde el APK. Útil para experimentar con diferentes convertidores/descompiladores sin tener que preocuparse por la configuración del classpath y los argumentos de la línea de comandos."  

Comando greep de manera recursiva, para identificar en que archivo se encuentra la linea que contenga información sobre el "Emulator detected". 

![image](/genes/dvba/grep1.png)

Una vez ubicado el archivo, se evalua el contenido de las línes de código y se identifíca que es necesario modificar el proceso de la aplicación de forma que no entre en el bloque de códgio específico de la línea 258. 

``` JS
// @File: scripts/script.js
setTimeout(function() {
    Java.perform(function() {

        // We are loading the class here
        var Rfunc = Java.use("a.a.a.a.a");

        // Whenever a.a.a.a.a.R() is called, the below code is executed
        Rfunc.R.implementation = function() {
            // Capture the return value of R function
            let retval = this.R();
            // Printing the value we got from this function
            console.log("Original return value = ", retval);
            // Toggle the return value to make sure it doesn't enter the if loop
            return !retval
        }
    })
}, 10);
```



*(1,1)*

<!-- Check out the [Jekyll docs][jekyll] for more info on how to get the most out of Jekyll. File all bugs/feature requests at [Jekyll’s GitHub repo][jekyll-gh]. If you have questions, you can ask them on [Jekyll’s dedicated Help repository][jekyll-help]. -->